<!DOCTYPE html>
<html>
  <head>
    <title>OAuth 2.0</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <link rel="stylesheet" href="/assets/stylesheets/all.css">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-PMZTG7B6GB"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      
      gtag('config', 'G-PMZTG7B6GB');
    </script>
  </head>
  <body>
    <header class="bg-orange-600">
      <nav class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="w-full py-6 flex items-center justify-between border-b border-orange-500 lg:border-none">
          <div class="flex items-center"><a class="text-xl font-bold text-white hover:text-orange-50" href="/">OAuth2orize</a>
            <div class="hidden ml-10 space-x-8 lg:block"><a class="text-base font-medium text-white hover:text-orange-50" href="/concepts/oauth2/">Documentation</a></div>
          </div>
        </div>
        <div class="py-4 flex flex-wrap justify-center space-x-6 lg:hidden"><a class="text-base font-medium text-white hover:text-orange-50" href="/concepts/oauth2/">Documentation</a></div>
      </nav>
    </header>
    <div><section class="chapter" id="README"><h1 id="overview">Overview</h1>
<p><a href="https://datatracker.ietf.org/doc/html/rfc6749">OAuth 2.0</a> is an authorization
framework that allows applications to gain access to an API.  This access is
granted with the consent of the user whose information is protected by the API.
Once granted, the application can the use the API to create and modify data that
the user has permitted the application to access.</p>
<p>OAuth2orize is a toolkit for building OAuth 2.0 servers.  OAuth2orize provides
<a href="https://expressjs.com/">Express</a> middleware used to implement OAuth 2.0
endpoints.  These endpoints allow applications to request authorization and
obtain tokens.  Additionally, OAuth2orize provides a pluggable suite of grants
and exchanges which correspond to the extensible set of authorization grants
defined by OAuth 2.0.</p>
<p>This guide provides an overview of OAuth 2.0.  As a framework, OAuth 2.0 is
highly extensible with many optional components, leaving numerous implementation
details to the developer.   This guide focuses on the fundamental and most
commonly used aspects of OAuth 2.0.  By reading this guide, you will gain an
understanding of how OAuth 2.0 works, and how to use OAuth2orize to build a
functional OAuth 2.0 server.</p>
</section><section class="chapter" id="use-case"><h1 id="use-case">Use Case</h1>
<p>To begin our journey in understanding OAuth 2.0, let&#39;s analyze a scenario that
illustrates the problem that OAuth 2.0 solves.</p>
<p>Alice has a checking account at Alpha Bank.  As part of its online banking
platform, Alpha Bank provides an API by which customer financial data, including
Alice&#39;s, can be accessed.  This API enables an ecosystem of third-party
services.</p>
<p>Budgetify is one of those third-party services, which helps customers like Alice
manage spending and savings.  By integrating with Alpha Bank&#39;s API, Budgetify is
able to automatically analyze transactions, providing Alice with intelligent
recommendations on how to reduce or eliminate expenses.</p>
<p>Before OAuth, this integration would require Alice to hand over her username and
password to Budgetify.  Since Alice has been rightfully warned to never share
her password with third parties, which she heeds, she is unable to benefit from
Budgetify&#39;s recommendations.</p>
<p>If Alice ignores the warning, she&#39;s placing a high degree of trust in Budgetify.
She&#39;s relying on Budgetify to securely store her password, a task which is
difficult to ensure given it needs to be available in cleartext.  Since her
password grants full access to her account, she&#39;s expecting Budgetify to use it
only for the purpose of reading transactions, and not to transfer money.  The
list of concerns only grows from here.  Clearly, this security model leaves a
lot to be desired.</p>
<p>OAuth 2.0 addresses these problems by issuing Budgetify an application-specific
credential, known as an <em>access token</em>, rather than requiring Budgetify to use
a user credential such as a password.  Budgetify obtains an access token by
making an authorization request to Alpha Bank.  This authorization request is
sent to Alpha Bank&#39;s <em>authorization server</em>, which is a part of Alpha Bank&#39;s
website.</p>
<p>When Alpha Bank&#39;s authorization server receives an authorization request, it is
responsible for two primary tasks:</p>
<ol>
<li>Logging Alice in.</li>
<li>Obtaining Alice&#39;s consent to allow Budgetify access to her account.</li>
</ol>
<p>Because Alice is now logging in directly to Alpha Bank&#39;s website, she no longer
has to share her password with Budgetify.  When giving her consent, Alice can
also indicate what <em>scope</em> of access Budgetify is allowed.  In this instance,
Budgetify&#39;s access can be restricted to only reading transactions, excluding
unnecessary permissions such as making transfers.  The permitted scope is
captured in Budgetify&#39;s application-specific access token, avoiding the overly
broad access that would otherwise have been allowed if Alice were to have shared
her password.</p>
<p>In OAuth 2.0, applications such as Budgetify are referred to as <em>clients</em>,  APIs
such as Alpha Bank&#39;s API are referred to as <em>resource servers</em>, and users such
as Alice are referred to as <em>resource owners</em>.  Throughout this guide, the words
&quot;application&quot;, &quot;API&quot;, and &quot;user&quot; will be used, since they are more natural
language.  Keep in mind that you will encounter the more formal terms as you
learn more about OAuth 2.0 and read documentation elsewhere.</p>
</section><section class="chapter" id="endpoints"><h1 id="endpoints">Endpoints</h1>
<p>OAuth 2.0 servers expose two endpoints: an authorization endpoint and a token
endpoint.</p>
<p>The authorization endpoint is used to interact with the user and obtain consent
to allow access.  This interaction occurs in the user&#39;s browser.  Applications
send authorization requests to the OAuth 2.0 server by redirecting the user&#39;s
browser to this endpoint.  Once the server receives the request, it interacts
with the user via a series of HTML pages, to log the user in and obtain the
user&#39;s consent.</p>
<p>The token endpoint is used by the application to obtain access tokens, after the
user has granted access.</p>
<p>OAuth2orize provides <a href="https://expressjs.com/">Express</a> middleware to implement
these endpoints.</p>
<pre><code class="lang-js"><span class="keyword">var</span> <span class="keyword">as</span> = oauth2orize.createServer();

app.get(<span class="string">'/authorize'</span>,
  <span class="keyword">as</span>.authorize(validate, authorize),
  <span class="function"><span class="keyword">function</span> <span class="title">interact</span>(<span class="params">req, res</span>) </span>{
    <span class="comment">// ...</span>
  });

app.post(<span class="string">'/token'</span>,
  passport.authenticate([<span class="string">'basic'</span>, <span class="string">'oauth2-client-password'</span>], { <span class="attr">session</span>: <span class="literal">false</span> }),
  <span class="keyword">as</span>.token(),
  <span class="keyword">as</span>.errorHandler());
</code></pre>
<p>As this guide progresses and additional OAuth 2.0 concepts are explained, more
details will be provided about how this middleware integrates with the other
aspects of the OAuth2orize toolkit.</p>
</section><section class="chapter" id="grants"><h1 id="authorization-grants">Authorization Grants</h1>
<p>OAuth 2.0 defines a set of <em>authorization grants</em> which represent the user&#39;s
consent to allow an application to access the user&#39;s data and information.
OAuth 2.0 specifies four types of authorization grants: <a href="https://datatracker.ietf.org/doc/html/rfc6749#section-1.3.1">authorization code</a>,
<a href="https://datatracker.ietf.org/doc/html/rfc6749#section-1.3.2">implicit</a>,
<a href="https://datatracker.ietf.org/doc/html/rfc6749#section-1.3.3">password</a>, and
<a href="https://datatracker.ietf.org/doc/html/rfc6749#section-1.3.4">client credentials</a>.</p>
<p>Each grant type uses one or both of the authorization endpoint and token
endpoint.</p>
<table>
<thead>
<tr>
<th>Grant Type</th>
<th>Authorization Endpoint</th>
<th>Token Endpoint</th>
</tr>
</thead>
<tbody>
<tr>
<td>Authorization Code</td>
<td>&check;</td>
<td>&check;</td>
</tr>
<tr>
<td>Implicit</td>
<td>&check;</td>
<td></td>
</tr>
<tr>
<td>Password</td>
<td></td>
<td>&check;</td>
</tr>
<tr>
<td>Client Credentials</td>
<td></td>
<td>&check;</td>
</tr>
</tbody>
</table>
<p>Grant types that do not use the authorization endpoint require applications to
handle user credentials directly.  For instance, the user&#39;s consent to grant
access is inferred from the act of the user handing over their password to an
application.  While this may be appropriate in certain scenarios, it diminishes
the security benefits of using OAuth, especially when authorizing third-party
applications, and fails to fully inform the user of the consequence of thier
action.</p>
<p>Grant types making use of the authorization endpoint are obtained by sending
authorization requests to the OAuth 2.0 server via redirecting the user&#39;s
browser to this endpoint.  The server, rather than the application, is then
handling user credentials as well as obtaining consent, which can be fully
informed.  In other words, the server is an intermediary between the user and
the application.</p>
<p>Using the server as an intermediary is the preferred method for obtaining
authorization, as it takes full advantage of the security benefits offered by
OAuth.  As such, this guide focuses on the authorization code and implict
grants, leaving other types for further reading.</p>
<p>For grant types that use the authorization endpoint, the grant is returned to
the application through a grant plugin supplied by OAuth2orize.  For example,
registering a plugin to issue an authorization code to the application:</p>
<pre><code><span class="keyword">as</span>.grant(oauth2orize.grant.code(<span class="function"><span class="keyword">function</span> <span class="title">issue</span><span class="params">(client, redirectURI, user, authz, cb)</span> </span>{
  <span class="comment">// ...</span>
}));
</code></pre><p>Similarly, for grant types that use the token endpoint, the grant is exchanged
for an access token through an exchange plugin supplied by OAuth2orize.  For
example, registering a plugin to exchange an authorization code for an access
token:</p>
<pre><code><span class="keyword">as</span>.exchange(oauth2orize.exchange.code(<span class="function"><span class="keyword">function</span> <span class="title">issue</span><span class="params">(client, code, redirectURI, cb)</span> </span>{
  <span class="comment">// ...</span>
}));
</code></pre><p>Corresponding to the table above, OAuth2orize exports a grant plugin for each
grant type that uses the authorization endpoint.</p>
<pre><code>oauth2orize.grant.code(...); // Authorization Code Grant
oauth2orize.grant.token(...); // <span class="keyword">Implicit</span> Grant
</code></pre><p>And OAuth2orize exports an exchange plugin for each grant type that uses the
token endpoint.</p>
<pre><code>oauth2orize.exchange.code(<span class="params">...</span>); <span class="comment">// Authorization Code Grant</span>
oauth2orize.exchange.password(<span class="params">...</span>); <span class="comment">// Password Grant</span>
oauth2orize.exchange.clientCredentials(<span class="params">...</span>); <span class="comment">// Client Credentials Grant</span>
</code></pre><p>As this guide progresses and additional OAuth 2.0 concepts are explained, more
details will be provided about how these plugins integrate with the other
aspects of the OAuth2orize toolkit.</p>
</section>
    </div>
    <footer class="bg-white">
      <div class="max-w-7xl mx-auto py-12 px-4 sm:px-6 md:flex md:items-center md:justify-between lg:px-8">
        <div class="flex justify-center space-x-6 md:order-2"><a class="text-gray-400 hover:text-gray-500" href="https://twitter.com/oauth2orize"><span class="sr-only">Twitter</span>
            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path d="M8.29 20.251c7.547 0 11.675-6.253 11.675-11.675 0-.178 0-.355-.012-.53A8.348 8.348 0 0022 5.92a8.19 8.19 0 01-2.357.646 4.118 4.118 0 001.804-2.27 8.224 8.224 0 01-2.605.996 4.107 4.107 0 00-6.993 3.743 11.65 11.65 0 01-8.457-4.287 4.106 4.106 0 001.27 5.477A4.072 4.072 0 012.8 9.713v.052a4.105 4.105 0 003.292 4.022 4.095 4.095 0 01-1.853.07 4.108 4.108 0 003.834 2.85A8.233 8.233 0 012 18.407a11.616 11.616 0 006.29 1.84"></path>
            </svg></a><a class="text-gray-400 hover:text-gray-500" href="https://github.com/jaredhanson/oauth2orize"><span class="sr-only">GitHub</span>
            <svg class="h-6 w-6" fill="currentColor" viewBox="0 0 24 24" aria-hidden="true">
              <path fill-rule="evenodd" d="M12 2C6.477 2 2 6.484 2 12.017c0 4.425 2.865 8.18 6.839 9.504.5.092.682-.217.682-.483 0-.237-.008-.868-.013-1.703-2.782.605-3.369-1.343-3.369-1.343-.454-1.158-1.11-1.466-1.11-1.466-.908-.62.069-.608.069-.608 1.003.07 1.531 1.032 1.531 1.032.892 1.53 2.341 1.088 2.91.832.092-.647.35-1.088.636-1.338-2.22-.253-4.555-1.113-4.555-4.951 0-1.093.39-1.988 1.029-2.688-.103-.253-.446-1.272.098-2.65 0 0 .84-.27 2.75 1.026A9.564 9.564 0 0112 6.844c.85.004 1.705.115 2.504.337 1.909-1.296 2.747-1.027 2.747-1.027.546 1.379.202 2.398.1 2.651.64.7 1.028 1.595 1.028 2.688 0 3.848-2.339 4.695-4.566 4.943.359.309.678.92.678 1.855 0 1.338-.012 2.419-.012 2.747 0 .268.18.58.688.482A10.019 10.019 0 0022 12.017C22 6.484 17.522 2 12 2z" clip-rule="evenodd"></path>
            </svg></a></div>
        <div class="mt-8 md:mt-0 md:order-1">
          <p class="text-center text-base text-gray-400">Copyright &copy; 2022 Jared Hanson. All rights reserved.</p>
        </div>
      </div>
    </footer>
  </body>
</html>